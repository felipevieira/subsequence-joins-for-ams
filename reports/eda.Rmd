---
title: "R Notebook"
output: html_notebook
---


```{r}
library(tidyverse)
library(here)
theme_set(theme_minimal())
```


```{r}
dados = read_csv(here("data/training_set_deepchromaOTI_mfcc_sl=10.csv"))

dados = dados %>% 
    mutate(`sim(A,B) > sim(A,C)` = as.logical(`y = sim(A,B) > sim(A,C) ^ sim(B,A) > sim(B,C)`), 
           ABmAC_chroma = simple_chroma_similar - simple_chroma_dissimilar,
           ABmAC_mfcc = simple_mfcc_similar - simple_mfcc_dissimilar)

summary(dados)
```

```{r}
box_e_pontos = function(p){
    p + 
    geom_boxplot(outlier.colour = NA, width = .2) + 
    geom_jitter(width = .15, alpha = .3, size = .5) + 
    theme(legend.position = "None")
}

```


```{r}
dados %>% 
    gather(key = "comparação", value = "subtração", 
           simple_chroma_similar, simple_chroma_dissimilar) %>% 
    ggplot(aes(x = `subtração`, colour = `comparação`)) + 
    geom_histogram(bins = 30, fill = "white") + 
    geom_rug(alpha = .2) + 
    facet_grid(`comparação` ~ ., scales = "free")

dados %>% 
    gather(key = "comparação", value = "subtração", 
           simple_mfcc_similar, simple_mfcc_dissimilar) %>% 
    ggplot(aes(x = `subtração`, colour = `comparação`)) + 
    geom_histogram(bins = 30, fill = "white") + 
    geom_rug(alpha = .2) + 
    facet_grid(`comparação` ~ ., scales = "free")

```

```{r}
set.seed(123)
balanceados = sample_n(dados, NROW(dados)) %>% 
    mutate(i = 1:n()) %>% 
    transmute(ab_mfcc = if_else(i < NROW(dados)/2, simple_mfcc_similar, simple_mfcc_dissimilar), 
              ac_mfcc = if_else(i < NROW(dados)/2, simple_mfcc_dissimilar, simple_mfcc_similar), 
              ab_chroma = if_else(i < NROW(dados)/2, simple_chroma_similar, simple_chroma_dissimilar), 
              ac_chroma = if_else(i < NROW(dados)/2, simple_chroma_dissimilar, simple_chroma_similar), 
              ab_gt_ac = if_else(i < NROW(dados)/2, TRUE, FALSE))
```



```{r}
balanceados %>% 
    ggplot(aes(x = ab_gt_ac, 
               y = ab_mfcc - ac_mfcc, 
               color = ab_gt_ac))  %>%
    box_e_pontos()
```


```{r}
# dados %>% 
#     ggplot(aes(x = `sim(A,B) > sim(A,C)`, 
#                y = `simple_chroma(A,B) - simple_chroma(A,C)`, 
#                color = `sim(A,B) > sim(A,C)`))  %>%
#     box_e_pontos()
```

```{r}
balanceados %>% 
    ggplot(aes(x = ab_gt_ac, 
               y = ab_chroma - ac_chroma, 
               color = ab_gt_ac))  %>%
    box_e_pontos()

```


```{r}
balanceados %>% 
    ggplot(aes(x = ab_chroma - ac_chroma, 
               y = ab_mfcc - ac_mfcc,
               color = ab_gt_ac)) + 
    geom_point(size = .8, alpha = .8) 

```

```{r}
balanceados %>% 
    ggplot(aes(x = ab_chroma - ac_chroma, 
               y = ab_mfcc - ac_mfcc,
               fill = ab_gt_ac)) +  
    # geom_point(size = 3, alpha = .3)
    geom_hex(alpha = .5)
```


```{r}
balanceados %>% 
    ggplot(aes(x = ab_chroma - ac_chroma, 
               y = ab_mfcc - ac_mfcc,
               color = ab_gt_ac)) +  
    geom_density2d()
```



```{r}
triplasl = dados %>%
    arrange(-simple_mfcc_AB) %>% 
    mutate(t = 1:n()) %>% 
    gather(
    key = "comparação",
    value = "valor",
    simple_mfcc_AB,
    simple_mfcc_AC,
    simple_mfcc_BC, 
    simple_chroma_AB, 
    simple_chroma_AC,
    simple_chroma_BC
    ) 

triplasl %>% 
    group_by(`comparação`) %>% 
    summarise(media = mean(`valor`), 
              mediana = median(valor), 
              min = min(valor), 
              max = max(valor))

# triplasl %>% 
#     # filter(t <= 10) %>% 
#     ggplot(aes(x = t,  y = `valor`, colour = `comparação`)) + 
#     geom_point(alpha = 1, size = 1)

```

